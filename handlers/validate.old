package handlers

import (
	"log"
	"net/http"

	"github.com/AleRosmo/cattp"

	"yalk/appcontext"
)

var ValidateHandle = cattp.HandlerFunc[appcontext.HandlerContext](func(w http.ResponseWriter, r *http.Request, ctx appcontext.HandlerContext) {
	defer r.Body.Close()
	sessionsManager := ctx.SessionManager()
	if r.Method != http.MethodGet {
		w.WriteHeader(http.StatusMethodNotAllowed)
		return
	}

	_, err := sessionsManager.Validate(r)
	if err != nil {
		// TODO: Extend session upon device validation
		log.Println("Invalid session")
		w.WriteHeader(http.StatusUnauthorized)
		return
	}

	// session.SetClientCookie(w)
	// TODO: Post response for WebSock?
	w.Header().Add("Content-Type", "application/json")
	// logger.Info("SESS", fmt.Sprintf("[%d][ID %v] Validated Session", http.StatusOK, session.AccountID))
	w.WriteHeader(http.StatusOK)
})
